@page "/phases"
@page "/phases/{developmentId:int}"
@rendermode InteractiveServer

@using RealEstateCMS.Components.Shared.Icons

<PageTitle>Faze</PageTitle>

<div class="page-header">
    <h1>Faze @(selectedDevelopment != null ? $"- {selectedDevelopment.Name}" : "")</h1>
    <div style="display: flex; gap: 1rem;">
        @if (DevelopmentId.HasValue)
        {
            <a href="/phases/create/@DevelopmentId" class="btn btn-primary">
                <span class="icon">+</span> Adaugă Fază
            </a>
        }
    </div>
</div>

@if (!DevelopmentId.HasValue)
{
    <div class="form-group">
        <label>Selectează Development</label>
        <select class="form-control" @onchange="OnDevelopmentChanged">
            <option value="">-- Selectează --</option>
            @foreach (var dev in developments)
            {
                <option value="@dev.DevelopmentId">@dev.Name</option>
            }
        </select>
    </div>
}

@if (phases == null)
{
    <p class="loading">Se încarcă...</p>
}
else if (!phases.Any())
{
    <div class="empty-state">
        <p>Nu există faze @(selectedDevelopment != null ? $"pentru {selectedDevelopment.Name}" : "").</p>
        @if (DevelopmentId.HasValue)
        {
            <a href="/phases/create/@DevelopmentId" class="btn btn-primary">
                Creează prima fază
            </a>
        }
    </div>
}
else
{
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Nume</th>
                    <th>Development</th>
                    <th>Data start</th>
                    <th>Clădiri</th>
                    <th>Tipuri locuințe</th>
                    <th class="actions-column">Acțiuni</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var phase in phases)
                {
                    <tr>
                        <td><strong>@phase.Name</strong></td>
                        <td>@phase.Development.Name</td>
                        <td>@(phase.StartDate?.ToString("dd.MM.yyyy") ?? "-")</td>
                        <td><span class="badge">@phase.Buildings.Count</span></td>
                        <td><span class="badge">@phase.HouseTypes.Count</span></td>
                        <td class="actions-column">
                            <div class="action-buttons">
                                <a href="/phases/edit/@phase.PhaseId"
                                   class="btn btn-sm btn-secondary"
                                   title="Editează">
                                    <EditIcon />
                                </a>
                                <button @onclick="() => DeletePhase(phase.PhaseId)"
                                        class="btn btn-sm btn-danger"
                                        title="Șterge">
                                    <DeleteIcon />
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
